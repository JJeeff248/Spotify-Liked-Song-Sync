<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Sync Settings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>Spotify Sync Settings</h1>
        <div id="processing" class="processing" hidden>
            <div class="loader" aria-label="Loading"></div>
            <p id="processing-message">Processing...</p>
            <div id="sync-progress" hidden>
                <p>Syncing: <span id="current-song">0</span> / <span id="total-songs">0</span></p>
                <progress id="progress-bar" value="0" max="100"></progress>
            </div>
        </div>
        <div id="content">
            <div id="current-playlist" class="current-playlist" {% if not current_playlist %}hidden{% endif %}>
                <img id="playlist-artwork" src="{{ current_playlist.images[0].url if current_playlist else '' }}" alt="Playlist artwork" class="playlist-artwork">
                <p id="playlist-name">{{ current_playlist.name if current_playlist else '' }}</p>
            </div>
            <form action="{{ url_for('toggle_sync') }}" method="post" id="settingsForm">
                <label for="playlist_id">Select Playlist:</label>
                <select id="playlist_id" name="playlist_id" required {% if is_syncing %}disabled{% endif %}>
                    {% for playlist in playlists %}
                        <option value="{{ playlist.id }}" 
                                data-image="{{ playlist.images[0].url if playlist.images else '' }}"
                                {% if (current_playlist and current_playlist.id == playlist.id) or (matching_playlist_id and matching_playlist_id == playlist.id) %}selected{% endif %}>
                            {{ playlist.name }}
                            {% if matching_playlist_id and matching_playlist_id == playlist.id %}
                                (Best Match)
                            {% endif %}
                        </option>
                    {% endfor %}
                </select>
                
                <button type="button" id="newPlaylistBtn" class="button">New Playlist</button>
                
                <div id="newPlaylistForm" hidden>
                    <input type="text" id="newPlaylistName" placeholder="Enter playlist name">
                    <button type="button" id="createPlaylistBtn">CREATE</button>
                </div>
                
                <label for="sync_interval">Sync Interval (hours):</label>
                <input type="number" id="sync_interval" name="sync_interval" min="5" max="168" value="{{ user_sync_interval }}" required {% if is_syncing %}disabled{% endif %}>
                
                <div class="button-container">
                    <button type="submit" class="button {% if is_syncing %}button-stop{% else %}button-start{% endif %}" id="toggleButton">
                        {% if is_syncing %}Stop Syncing{% else %}Start Sync{% endif %}
                    </button>
                    <a href="{{ url_for('logout') }}" class="button button-logout">Sign Out</a>
                </div>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='settings.js') }}"></script>
</body>
</html>
