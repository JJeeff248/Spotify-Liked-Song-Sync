<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Spotify Sync</title>
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='styles.css') }}"
        />
    </head>
    <body>
        <div class="container">
            <h1>Spotify Sync</h1>
            <p>Sync your liked songs to a playlist</p>
            <div id="loading" class="loading" style="display: none">
                <div class="loader"></div>
                <p id="loading-message">Connecting to Spotify...</p>
            </div>
            <div id="login-button" class="button-container">
                <a
                    href="{{ url_for('login') }}"
                    class="button-login"
                    onclick="showLoading()"
                    >Login with Spotify</a
                >
            </div>
            <p class="privacy-link">
                <span class="privacy-button" onclick="openPrivacyModal()">Privacy Statement</span>
            </p>
        </div>

        <!-- Privacy Modal -->
        <div id="privacyModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closePrivacyModal()">&times;</span>
                <h2>Privacy Statement</h2>
                <p>
                    We value your privacy and aim to be transparent about the data we collect and store. 
                    This application accesses your Spotify account to sync your liked songs to a playlist 
                    and stores certain information to provide you with a seamless experience.
                </p>
                <h3>Data We Store</h3>
                <p>
                    We store the following information from your Spotify account in our database:
                </p>
                <ul>
                    <li>Your Spotify user ID</li>
                    <li>Access and refresh tokens (securely encrypted)</li>
                    <li>Your selected playlist ID for syncing</li>
                    <li>Timestamps of your last sync operation</li>
                </ul>
                <p>
                    We do not store your personal information such as your name, email address, or any of your 
                    Spotify listening history beyond what's necessary for the syncing process.
                </p>
                <h3>How We Use Your Data</h3>
                <p>
                    The stored data is used solely for the purpose of maintaining your sync preferences and 
                    ensuring efficient synchronization between your liked songs and the selected playlist. 
                    We do not share this data with any third parties.
                </p>
                <p>
                    By using this application, you agree to this data storage and to Spotify's terms of service 
                    and privacy policy. You can revoke access to your Spotify account at any time through your 
                    Spotify account settings or by contacting us.
                </p>
            </div>
        </div>

        <script>
            const loadingMessages = [
                "Connecting to Spotify...",
                "Comparing playlists...",
                "Analyzing your music taste...",
            ];

            let currentMessageIndex = 0;

            function showLoading() {
                document.getElementById("loading").style.display = "flex";
                document.getElementById("login-button").style.display = "none";
                rotateLoadingMessage();
            }

            function rotateLoadingMessage() {
                const loadingMessageElement =
                    document.getElementById("loading-message");
                setInterval(() => {
                    currentMessageIndex =
                        (currentMessageIndex + 1) % loadingMessages.length;
                    loadingMessageElement.textContent =
                        loadingMessages[currentMessageIndex];
                }, Math.floor(Math.random() * (8000 - 6000 + 1)) + 6000); // Change message every 6-8 seconds
            }

            function openPrivacyModal() {
                document.getElementById("privacyModal").style.display = "flex";
            }

            function closePrivacyModal() {
                document.getElementById("privacyModal").style.display = "none";
            }

            // Close the modal if the user clicks outside of it
            window.onclick = function(event) {
                var modal = document.getElementById("privacyModal");
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        </script>
    </body>
</html>
